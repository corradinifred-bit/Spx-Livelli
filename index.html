<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SPX Strike Calculator</title>
  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
    body { margin: 0; padding: 24px; background:#0f172a; color:#e2e8f0; }
    .card { max-width: 900px; margin: 0 auto; background:#0b1220; border:1px solid #1f2937; border-radius:18px; padding:24px; box-shadow: 0 10px 30px rgba(0,0,0,.25); }
    h1 { margin: 0 0 8px 0; font-size: 22px; letter-spacing: .2px; }
    .sub { margin:0 0 16px 0; font-size:13px; color:#94a3b8 }
    label { display:block; margin: 12px 0 6px; font-size: 13px; color:#94a3b8 }
    select, input[type="text"] { width:100%; padding:12px 14px; border-radius:12px; background:#0b1220; color:#e2e8f0; border:1px solid #1e293b; outline:none; }
    select:focus, input:focus { border-color:#475569; }
    .row { display:flex; gap:12px; flex-wrap: wrap; align-items:flex-end; }
    .row > div { flex:1 1 240px; min-width: 240px; }
    .btn { padding:12px 16px; border-radius:12px; background:#0b1220; border:1px solid #1e293b; color:#e2e8f0; cursor:pointer; font-weight:600; }
    .btn:hover { border-color:#334155; }
    .btn.primary { background:#111827; border-color:#334155; }
    table { width:100%; border-collapse: collapse; margin-top: 18px; }
    th, td { text-align:left; padding:12px; border-bottom:1px solid #1f2937; }
    th { font-size:12px; color:#94a3b8; font-weight:600 }
    .muted { color:#94a3b8; font-size:12px; }
    .pill { display:inline-block; padding:4px 10px; border-radius:999px; background:#0b1220; border:1px solid #1e293b; font-size:12px; color:#94a3b8 }
    .footer { margin-top:16px; font-size:12px; color:#64748b; display:flex; gap:8px; align-items:center; flex-wrap:wrap }
    .hidden { display:none; }
    .error { color:#fca5a5; font-size:13px; margin-top:8px; }
    .atm { font-size:11px; padding:2px 6px; border:1px solid #1e293b; border-radius:8px; margin-left:6px; color:#93c5fd; }

    /* Contract pills colored by direction */
    .contracts-long {
      font-size:11px;
      padding:2px 8px;
      border:1px solid #1e293b;
      border-radius:999px;
      color:#bfdbfe;             /* light blue text */
      background:#1e3a8a20;      /* translucent blue bg */
    }
    .contracts-short {
      font-size:11px;
      padding:2px 8px;
      border:1px solid #1e293b;
      border-radius:999px;
      color:#fecaca;             /* light red text */
      background:#7f1d1d20;      /* translucent red bg */
    }
  </style>
</head>
<body>
  <div class="card">
    <h1>SPX Strike Calculator</h1>
    <p class="sub">Seleziona la strategia, inserisci il prezzo SPX e premi <strong>Dammi i Livelli</strong>.</p>
    <div class="row">
      <div>
        <label for="strategy">Strategia</label>
        <select id="strategy">
          <option value="RIC">RIC</option>
          <option value="FLY">FLY</option>
          <option value="BOOST UP">BOOST UP</option>
        </select>
      </div>
      <div>
        <label for="price">Prezzo SPX</label>
        <input id="price" type="text" inputmode="decimal" placeholder="es. 5534,27 o 5534.27" />
      </div>
      <div style="flex:0 0 auto">
        <button class="btn primary" type="button" onclick="compute()">Dammi i Livelli</button>
        <button class="btn" type="button" onclick="resetAll()">Reset</button>
      </div>
    </div>
    <div id="error" class="error hidden">Inserisci un prezzo SPX valido (es: 5534,27).</div>
    <table id="results" class="hidden">
      <thead>
        <tr>
          <th>Gamba</th>
          <th>Regola</th>
          <th>Contratti</th>
          <th>Strike</th>
        </tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>
    <div class="footer">
      <span class="pill">Colori: Long = azzurro, Short = rosso</span>
      <span id="summary" class="muted"></span>
    </div>
  </div>

  <script>
    const mapping = {"RIC": [{"label": "Short CALL", "type": "offset", "value": 40, "contracts": 1}, {"label": "Long CALL", "type": "offset", "value": 10, "contracts": 1}, {"label": "Short PUT", "type": "offset", "value": -45, "contracts": 1}, {"label": "Long PUT", "type": "offset", "value": -15, "contracts": 1}], "FLY": [{"label": "Long CALL ATM", "type": "atm", "contracts": 1}, {"label": "Short CALL +0,6%", "type": "percent", "value": 0.006, "contracts": 2}, {"label": "Long CALL +1,2%", "type": "percent", "value": 0.012, "contracts": 1}], "BOOST UP": [{"label": "Long CALL ATM", "type": "atm", "contracts": 1}, {"label": "Short CALL +50", "type": "offset", "value": 50, "contracts": 2}, {"label": "Long CALL +100", "type": "offset", "value": 100, "contracts": 1}]};

    const strategyEl = document.getElementById('strategy');
    const priceEl = document.getElementById('price');
    const tableEl = document.getElementById('results');
    const tbodyEl = document.getElementById('tbody');
    const errorEl = document.getElementById('error');
    const summaryEl = document.getElementById('summary');

    function parsePrice(value) {
      if (!value) return NaN;
      let v = String(value).trim().replace(/\s+/g, '');
      v = v.replace(',', '.');
      const parts = v.split('.');
      if (parts.length > 2) {
        const dec = parts.pop();
        v = parts.join('') + '.' + dec;
      }
      const num = Number(v);
      return num;
    }

    function fmt(n) {
      return Number(n).toLocaleString('it-IT', { maximumFractionDigits: 2, minimumFractionDigits: 0 });
    }

    function fmtPct(x) {
      const pct = (Number(x) * 100).toLocaleString('it-IT', { maximumFractionDigits: 2, minimumFractionDigits: 0 });
      return pct.replace('.', ',') + '%';
    }

    function showError(msg) {
      errorEl.textContent = msg || 'Inserisci un prezzo SPX valido.';
      errorEl.classList.remove('hidden');
      tableEl.classList.add('hidden');
      summaryEl.textContent = '';
    }

    function clearError() {
      errorEl.classList.add('hidden');
    }

    function isShortLabel(text) {
      return String(text).toLowerCase().indexOf('short') !== -1;
    }

    function compute() {
      const strat = strategyEl.value;
      const priceRaw = priceEl.value;
      const price = parsePrice(priceRaw);

      if (!(price > 0)) {
        showError('Inserisci un prezzo SPX valido (es: 5534,27).');
        return;
      }
      clearError();

      const legs = mapping[strat] || [];
      tbodyEl.innerHTML = '';

      legs.forEach((leg) => {
        let strike = 0;
        let ruleTxt = '';
        if (leg.type === 'atm') {
          strike = price;
          ruleTxt = 'ATM (uguale a SPX)';
        } else if (leg.type === 'offset') {
          strike = price + Number(leg.value);
          const sign = leg.value > 0 ? '+' : '';
          ruleTxt = `SPX ${sign}${leg.value}`;
        } else if (leg.type === 'percent') {
          strike = price * (1 + Number(leg.value));
          const sign = leg.value > 0 ? '+' : '';
          ruleTxt = `SPX ${sign}${fmtPct(leg.value)}`;
        } else {
          return;
        }

        const contracts = leg.contracts != null ? leg.contracts : 1;
        const cssClass = isShortLabel(leg.label) ? 'contracts-short' : 'contracts-long';

        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${leg.label} ${leg.type === 'atm' ? '<span class="atm">ATM</span>' : ''}</td>
          <td>${ruleTxt}</td>
          <td><span class="${cssClass}">${contracts} ${contracts === 1 ? 'contratto' : 'contratti'}</span></td>
          <td><strong>${fmt(strike)}</strong></td>
        `;
        tbodyEl.appendChild(tr);
      });

      tableEl.classList.remove('hidden');
      summaryEl.textContent = `Strategia: ${strat} â€” Gambe: ${legs.length}`;
    }

    function resetAll() {
      priceEl.value = '';
      tableEl.classList.add('hidden');
      summaryEl.textContent = '';
      clearError();
    }
  </script>
  <noscript style="color:#fca5a5; display:block; text-align:center; margin-top:12px;">
    Per usare il calcolatore abilita JavaScript nel browser.
  </noscript>
</body>
</html>
